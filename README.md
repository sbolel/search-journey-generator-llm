# Search Journey Generator LLM

This project demonstrates how to generate realistic, multi-step user queries for a selected topic using:

- A **state machine** to model research states (broad to narrow).
- A **mock search engine** to simulate feedback on each query (success, partial, failure).
- **OpenAI's** LLM integration to rewrite or refine queries based on context.
- **Personas** that produce different search styles (e.g., casual vs. in-depth).

---

## Project Overview

The **Search Journey Generator** simulates how a real user refines their search terms step by step. We accomplish this by:

1. Picking a **random topic** (e.g., _Educational Technology_).
2. Starting with a broad query (e.g., `"Educational Technology updates 2025"`).
3. Passing that query to a **mock search engine** that returns a (random) _relevance score_.
4. Depending on success or failure, we **transition** to a new state (from broad overview to deeper or comparative queries).
5. The code calls **OpenAI’s LLM** to create a refined or rewritten query, following instructions to avoid repetition and maintain a cohesive topic.
6. Different **personas** produce different query styles and lengths.

This can be helpful for:

- Generating synthetic search sessions
- Testing search engines or SEO workflows
- Exploring how users might refine queries in an automated manner

---

## Features

- **LLM-Powered Query Rewrites**: Each new query is generated by OpenAI’s LLM (v4+ library).
- **State Machine**: Enforces a logical progression from broad → refinement → comparison → expert detail → final synthesis.
- **Mock Search Feedback**: A random success/failure approach steers the transitions, reflecting user experiences.
- **Persona-Based**: Casual vs. in-depth personas yield different query tones and expansions.

---

## Prerequisites

- **Node.js** v20 or higher
- **Yarn** (or npm, though Yarn is recommended)
- **OpenAI API key** (for calling the LLM)

---

## Setup Instructions

### 1. Clone the Repository

```bash
git clone https://github.com/your-org/user-journey-generator-llm.git
cd user-journey-generator-llm
```

_(Replace the URL with your actual repo URL.)_

### 2. Install Dependencies

```bash
yarn
```

This will install all the required packages (TypeScript, OpenAI, dotenv, etc.).

### 3. Environment Variables

Create a file called **`.env`** in the project root (or set environment variables by other means). Within it, define:

```bash
OPENAI_API_KEY=sk-xxxxxxx
```

Replace `sk-xxxxxxx` with your actual API key. **Do not commit** your private key to version control.

---

## Usage

### Run the Generator

From your project root, execute:

```bash
yarn start
```

This command runs `npx ts-node src/index.ts`, which:

1. Chooses a random topic from `topics.ts`.
2. Generates a series of queries for **casual** and **in-depth** personas (and optionally others).
3. Prints them to your console.

### Sample Output

A typical run might look like:

```
=== Generating queries for topic: "Educational Technology" ===

----- Casual Researcher Queries -----
1. Educational Technology updates 2025
2. Best tools for online classroom engagement
3. Easy ways to implement gamification in lessons

----- In-Depth Analyst Queries -----
1. Educational Technology updates 2025
2. Comparative study of AI-based adaptive learning platforms
3. Expert perspectives on next-gen LMS solutions
...
```

---

## Customizing Options

### 1. Personas and Their Hints

- **Location**: [`src/personas.ts`](./src/personas.ts)
- Each persona has:
  - `name`: e.g. `"CasualResearcher"`.
  - `maxQueries`: how many queries they produce.
  - `commonExpansions`: an array of expansions, though these are no longer appended directly but can still guide the rewriting.

You can add or modify these to produce new or different personas.

### 2. Topic List

- **Location**: [`src/topics.ts`](./src/topics.ts)
- Contains a simple array of 50 broad topics such as `"AI Advancements"`, `"Climate Change"`, `"Music and Entertainment"`.
- You can add or remove topics to shape the domain of the generated queries.

### 3. LLM Model and Prompts

- **Location**: [`src/llmExpansion.ts`](./src/llmExpansion.ts)
- Important variables:
  - `MODEL`: can be changed to `"gpt-3.5-turbo"`, `"gpt-4"`, or other variations.
  - `systemPrompt` and `userPrompt`: define how the model rewrites queries.
- You can tailor the **tone** or **constraints**. For instance, you can specify “no parentheses,” “short queries,” or “use advanced terminology.”

### 4. State Machine Logic

- **Location**: [`src/queryStateMachine.ts`](./src/queryStateMachine.ts)
- Outlines how the Search journey transitions between states:
  - `BroadOverview → Refinement` or `Comparison`
  - `Refinement → Comparison` or `ExpertDetail`
  - `ExpertDetail → FinalSynthesis` or `Comparison`
- If you want a different flow, you can edit the transitions.

### 5. Mock Search Feedback

- **Location**: [`src/mockSearchEngine.ts`](./src/mockSearchEngine.ts)
- Returns a random `relevanceScore` (0 to 1) and a snippet.
- The code treats higher scores as “success,” moderate as “partial,” and low as “failure,” then chooses a new state accordingly.
- Replace this with a real search engine API if you want genuine results.

---

## Development

### Scripts

- **`yarn start`**: Runs `npx ts-node src/index.ts`.
- **`yarn test`**: Placeholder script for tests you may add.
- **`yarn format`**: Runs Prettier to format code.

### Code Structure

```
.
├── src
│   ├── index.ts             # Entry point
│   ├── userJourneyGenerator.ts
│   ├── llmExpansion.ts
│   ├── mockSearchEngine.ts
│   ├── queryStateMachine.ts
│   ├── personas.ts
│   └── topics.ts
├── .env                     # Contains OPENAI_API_KEY
├── tsconfig.json
├── package.json
└── yarn.lock
```

- **`index.ts`**: Orchestrates picking a random topic and generating queries for each persona.
- **`userJourneyGenerator.ts`**: Runs the feedback loop, references the state machine, calls the LLM for expansions.
- **`llmExpansion.ts`**: Houses system/user prompts and calls the OpenAI API.
- **`mockSearchEngine.ts`**: Simulates search feedback.

---

## Contributing

1. **Fork** the repository.
2. **Create a branch** for your feature or fix.
3. **Open a pull request** describing your changes.

All contributions are welcome—especially new personas, expansions, or improvements to the state machine.

---

## License

Distributed under the [MIT License](LICENSE). You’re free to use, modify, and redistribute this project in personal or commercial contexts.
